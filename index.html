<!DOCTYPE html>
<html>
<head>
  <title>Conway's Game of Life</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    canvas {
      display: block;
      width: 50%;
      height: 50%;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <canvas id="canvas"></canvas>
  <script>
    const canvas = document.getElementById('canvas');
    const gl =  canvas.getContext('webgl', { antialias: true });
    canvas.width = canvas.clientWidth * window.devicePixelRatio;
    canvas.height = canvas.clientHeight * window.devicePixelRatio;
    gl.viewport(0, 0, canvas.width, canvas.height);
    const gridRows = 256;
    const gridCols = 256;
    const cellSize = 16;
    let grid = [];
    let nextGrid = [];
    for (let i = 0; i < gridRows * gridCols; i++) {
        grid.push(Math.random() > 0.5 ? 1 : 0);
        nextGrid.push(0);
    }
    gl.enable(gl.SCISSOR_TEST);
    function renderGameOfLife() {
        gl.clear(gl.COLOR_BUFFER_BIT);
        for (let row = 0; row < gridRows; row++) {
            for (let col = 0; col < gridCols; col++) {
                const cellIndex = row * gridCols + col;
                const cellState = grid[cellIndex];
                const cellX = col * cellSize;
                const cellY = row * cellSize;
                gl.scissor(cellX, cellY, cellSize, cellSize);
                const color = cellState === 1 ? [0.0, 0.0, 0.0, 1.0] : [1.0, 1.0, 1.0, 1.0];
                gl.clearColor(...color);
                gl.clear(gl.COLOR_BUFFER_BIT);
            }
        }
        updateGameState();
        [grid, nextGrid] = [nextGrid, grid];
        setTimeout(renderGameOfLife, 1);
    }
    function updateGameState() {
        for (let row = 0; row < gridRows; row++) {
            for (let col = 0; col < gridCols; col++) {
                const cellIndex = row * gridCols + col;
                const cellState = grid[cellIndex];
                const liveNeighborCount = countLiveNeighbors(row, col);
                let newCellState = 0;
                if (cellState % 2 == 1 && cellIndex % 2 == 0) {
                    newCellState ^= ((cellState) - (cellIndex % 8)) % Math.floor(Math.random() * 4.5);
                }
                if (cellState === 1) {
                    if (liveNeighborCount === 2 || liveNeighborCount === 3) {
                        newCellState = 1;
                    }
                }
                 else {
                    if (liveNeighborCount === 3) {
                        newCellState = 1;
                    }
                }
                nextGrid[cellIndex] = newCellState;
            }
        }
    }
    function countLiveNeighbors(row, col) {
        let liveNeighborCount = 0;
        for (let dx = -1; dx <= 1; dx++) {
            for (let dy = -1; dy <= 1; dy++) {
                if (dx === 0 && dy === 0) continue;
                const neighborRow = (row + dx + gridRows) % gridRows;
                const neighborCol = (col + dy + gridCols) % gridCols;
                const neighborIndex = neighborRow * gridCols + neighborCol;
                liveNeighborCount += grid[neighborIndex];
            }
        }
        return liveNeighborCount;
    }
    renderGameOfLife();
  </script>
</body>
</html>
